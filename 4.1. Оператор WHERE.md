# 4.1. Оператор WHERE

## SELECT 

Данный оператор используется для извлечения данных из одной или нескольких таблиц.

Самый простой синтаксис данного оператора имеет вид:

```sql
SELECT [DISTINCT] <список_выражений>
FROM <таблица>
[WHERE <условие>]
[GROUP BY <список_группировки>]
[HAVING <условие>]
[ORDER BY <список сортировки>[ ASC | DESC ]]
[LIMIT <количество_строк>];
```
<br>

**[DISTINCT]** - необязательный параметр. Удаляет дубликаты из набора результата.

**<список_выражений>** -  столбцы или вычисления, которые вы хотите получить. Используйте *, если вы хотите выбрать все столбцы.

**<таблица> -** таблицы, из которых вы хотите получить записи. Должна быть хотя бы одна таблица, перечисленная в предложении FROM

**[WHERE <условие>]** - необязательный параметр. Условия, которые должны быть выполнены для выбранных записей.

**[GROUP BY <список_группировки>] -** необязательный параметр. Он собирает данные по нескольким записям и группирует результаты по одному или нескольким столбцам.

**[HAVING <условие>]** - необязательный параметр. Он используется в сочетании с GROUP BY, чтобы ограничить группы возвращаемых строк только теми, чье условие Правда. 

**[ORDER BY <список сортировки>[ ASC | DESC ]]** - необязательный параметр. Он используется для сортировки записей в вашем результирующем наборе. ASC - сортировка по возрастанию, DESC  - сортировка по убыванию.

**[LIMIT <количество_строк>]** -  задает ограниченное количество строк в результирующем наборе. Например, LIMIT 10 вернет первые 10 строк, соответствующих критериям SELECT. В этом случае порядок сортировки имеет значение, поэтому обязательно используйте оператор ORDER BY соответствующим образом.
<br>
<br>

Постепенно разберем каждый параметр более подробно. Сейчас с помощью SELECT выведем всю информацию о Врачах.

```sql
SELECT * FROM doctors;
```

* означает, что необходимо вывести все столбцы указанной таблицы _**doctors**_. В результате запуска данной команды в MySQL Workbench получим следующий результат:

<image src="/img/4.1. pic1.png" alt="">
<br>
<br>

При необходимости вывода только нескольких столбцов, используйте перечисление через запятую, например:

```sql
SELECT doctor_num, doctor_name FROM doctors;
```
<br>
<br>

### **_Вывести информацию о ФИО и датах рождения пациентов._**

Исходная таблица patients:

<image src="/img/4.1. pic2.png" alt="">
<br>
<br>

```sql
SELECT full_name, birth_date
FROM patients
```
<br>
<br>
<br>

## DISTINCT

DISTINCT возвращает уникальные значения для указанных столбцов или выражений.

Рассмотрим простейший пример использования. Давайте проверим, какие уникальные даты посещений у нас есть в талонах.

Таблица _**talons**_:

<image src="/img/4.1. pic3.png" alt="">
<br>

Для этого формируем скрипт, который выведет уникальные _**visit_time**_ из таблицы:

```sql
SELECT DISTINCT visit_time FROM talons;
```
<br>

Результат:

<image src="/img/4.1. pic4.png" alt="">
<br>
  
Видно, что в таблице было два талона на 18-08-2023, в результате обработки DISTINCT мы вывели одно уникальное значение для этих двух талонов.
<br>
<br>
<br>

### _**Используя DISTINCT в запросе, выведите информацию о том какие доктора какого числа принимали пациентов (выведите уникальные номер доктора и дату посещения).**_

Исходная таблица _**talons**_:

<image src="/img/4.1. pic5.png" alt="">
<br>

```sql
SELECT DISTINCT doctor_num, visit_time
FROM talons
```
<br>
<br>

## **WHERE <условие>**

Данный оператор используется для фильтрации строк в результирующем наборе. Если условие, накладываемое на строку будет True, то строка попадет в результат, если будет равно False, то данная строка не попадет в результат.

Пример с _**одним условием**_:

```sql
SELECT * FROM doctors
WHERE cabinet_num = 21;
```

В результирующий набор попадут только те строки, где номер кабинета будет равен 21. Результат выполнения запроса будет иметь вид:

<image src="/img/4.1. pic6.png" alt="">
<br>

Условия состоят из операторов сравнения (перечислены на следующем шаге) и операторов **NOT** (НЕ), **AND**(И) и **OR**(ИЛИ). Приоритет NOT больше, чем AND, а приоритет AND больше чем OR. Для указания последовательности вычисления условий можно использовать круглые скобки.

 Разберем на примере:

```sql
SELECT * FROM doctors
WHERE (cabinet_num = 21 OR cabinet_num = 11)
AND NOT spec = 'терапевт';
```
<br>

Строка войдет в результирующий набор, если:

1) Номер кабинета будет равен 21 **или** 11

**И**

2) Специальность у доктора - **НЕ** терапевт

Результат:

<image src="/img/4.1. pic7.png" alt="">
<br>
<br>

Список _**операторов сравнения**_ приведен в таблице:

|Операторы сравнения|Описание|Пример|
|---|---|---|
|=|Равно|where cabinet_num = 21|
|<>, !=|Не равно|where cabinet_num != 21|
|>|Больше, чем|where cabinet_num > 21|
|>=|Больше или равно|where cabinet_num >= 21|
|<|Меньше, чем|where cabinet_num < 21|
|<=|Меньше или равно|where cabinet_num <= 21|
|IN ( )|Соответствует значению в списке|where cabinet_num in (21, 11)|
|BETWEEN|В пределах диапазона (включительно)|where cabinet_num between 10 and 20|
|IS NULL|Значение NULL|where cabinet_num IS NULL|
|IS NOT NULL|Значение, не NULL|where cabinet_num IS NOT NULL|
|LIKE|Соответствие шаблону % и _|where full_name like 'Иван%' (ФИО начинается на Иван)|
|EXISTS|Условие выполняется, если подзапрос возвращает хотя бы одну строку|where exists (select * from med_area where area_num = 10)|
<br>
<br>

### _**В скрипте пропущен оператор. В поле ввода текста введите одно слово - этот оператор:**_

```sql
SELECT * FROM talons
WHERE doctor_num = 1 ____ doctor_num = 3;
```
<br>

_**чтобы получился верный запрос, который возвращает следующий набор данных:**_

<image src="/img/4.1. pic8.png" alt="">
<br>

Исходные данные таблицы talons:

<image src="/img/4.1. pic9.png" alt="">
<br>

```sql
OR
```
<br>
<br>
<br>

### _**Выведите информацию обо всех пациентах, родившихся после 01-01-1980 года.**_

Исходная таблица patients:

<image src="/img/4.1. pic10.png" alt="">
<br>

_! Дату в скрипте указываем в формате строки 'YYYY-MM-DD'_
<br>
<br>

```sql
SELECT *
FROM patients
WHERE birth_date > '1980-01-01'
```
<br>
<br>
<br>

### **_Вывести информацию обо всех врачах, ведущих прием в кабинетах с 10 по 20._**

Исходная таблица doctors:

<image src="/img/4.1. pic11.png" alt="">
<br>
<br>

```sql
SELECT *
FROM doctors
WHERE cabinet_num BETWEEN 10 AND 20
```
<br>
<br>

### **_Вывести ФИО врачей, работающих по специализации: терапевт, кардиолог, окулист (используйте оператор IN или OR)._**

Исходная таблица doctors:

<image src="/img/4.1. pic12.png" alt="">
<br>

```sql
SELECT doctor_name
FROM doctors
WHERE spec = 'терапевт' OR spec = 'кардиолог' OR spec = 'окулист'
```
<br>
<br>

### **_Вывести информацию о врачах, фамилия которых начинается с буквы А, В или М._**

Таблица doctors:

<image src="/img/4.1. pic13.png" alt="">
<br>

```sql
SELECT *
FROM doctors
WHERE doctor_name LIKE 'А%' OR doctor_name LIKE 'В%' OR doctor_name LIKE 'М%'
```
<br>
<br>
<br>

### **_Вывести информацию о врачах, у которых не указана специализация._**

Исходная таблица doctors (! добавили нового врача):

<image src="/img/4.1. pic14.png" alt="">
<br>

```sql
SELECT *
FROM doctors
WHERE spec IS NULL
```
